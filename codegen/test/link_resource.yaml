# yaml-language-server: $schema=./schema.json

# Copyright (c) Meta Platforms, Inc. and affiliates.
# Copyright (c) WhatsApp LLC
#
# This source code is licensed under the MIT license found in the
# LICENSE.md file in the root directory of this source tree.

---
suite:
  name: link_resource
  created: 2025-10-09
  modified: 2025-10-09
shared_options:
  - name: danger
    options:
      compile:
        allow_dangerous_html: true
        allow_dangerous_protocol: true
to_html:
- name: test_link_resource_case_1
  input: "[link](/uri \"title\")"
  output: "<p><a href=\"/uri\" title=\"title\">link</a></p>"
  message: should support links
- name: test_link_resource_case_2
  input: '[link](/uri)'
  output: "<p><a href=\"/uri\">link</a></p>"
  message: should support links w/o title
- name: test_link_resource_case_3
  input: '[link]()'
  output: "<p><a href=\"\">link</a></p>"
  message: should support links w/o destination
- name: test_link_resource_case_4
  input: '[link](<>)'
  output: "<p><a href=\"\">link</a></p>"
  message: should support links w/ empty enclosed destination
- name: test_link_resource_case_5
  input: '[link](/my uri)'
  output: <p>[link](/my uri)</p>
  message: should not support links w/ spaces in destination
- name: test_link_resource_case_6
  input: '[link](</my uri>)'
  output: "<p><a href=\"/my%20uri\">link</a></p>"
  message: should support links w/ spaces in enclosed destination
- name: test_link_resource_case_7
  input: |-
    [link](foo
    bar)
  output: |-
    <p>[link](foo
    bar)</p>
  message: should not support links w/ line endings in destination
- name: test_link_resource_case_9
  input: '[a](<b)c>)'
  output: "<p><a href=\"b)c\">a</a></p>"
  message: should support links w/ closing parens in destination
- name: test_link_resource_case_10
  input: "[link](<foo\\>)"
  output: <p>[link](&lt;foo&gt;)</p>
  message: should not support links w/ enclosed destinations w/o end
- name: test_link_resource_case_12
  input: "[link](\\(foo\\))"
  output: "<p><a href=\"(foo)\">link</a></p>"
  message: should support links w/ destinations w/ escaped parens
- name: test_link_resource_case_13
  input: '[link](foo(and(bar)))'
  output: "<p><a href=\"foo(and(bar))\">link</a></p>"
  message: should support links w/ destinations w/ balanced parens
- name: test_link_resource_case_14
  input: "[link](foo\\(and\\(bar\\))"
  output: "<p><a href=\"foo(and(bar)\">link</a></p>"
  message: should support links w/ destinations w/ escaped parens
- name: test_link_resource_case_15
  input: '[link](<foo(and(bar)>)'
  output: "<p><a href=\"foo(and(bar)\">link</a></p>"
  message: should support links w/ enclosed destinations w/ parens
- name: test_link_resource_case_17
  input: '[link](#fragment)'
  output: "<p><a href=\"#fragment\">link</a></p>"
  message: should support links w/ destinations to fragments
- name: test_link_resource_case_18
  input: '[link](http://example.com#fragment)'
  output: "<p><a href=\"http://example.com#fragment\">link</a></p>"
  message: should support links w/ destinations to URLs w/ fragments
- name: test_link_resource_case_19
  input: '[link](http://example.com?foo=3#frag)'
  output: "<p><a href=\"http://example.com?foo=3#frag\">link</a></p>"
  message: should support links w/ destinations to URLs w/ search and fragments
- name: test_link_resource_case_20
  input: "[link](foo\\bar)"
  output: "<p><a href=\"foo%5Cbar\">link</a></p>"
  message: should not support non-punctuation character escapes in links
- name: test_link_resource_case_21
  input: '[link](foo%20b&auml;)'
  output: "<p><a href=\"foo%20b%C3%A4\">link</a></p>"
  message: should support character references in links
- name: test_link_resource_case_22
  input: "[link](\"title\")"
  output: "<p><a href=\"%22title%22\">link</a></p>"
  message: should not support links w/ only a title
- name: test_link_resource_case_23
  input: "[link](/url \"title\")"
  output: "<p><a href=\"/url\" title=\"title\">link</a></p>"
  message: should support titles w/ double quotes
- name: test_link_resource_case_24
  input: '[link](/url ''title'')'
  output: "<p><a href=\"/url\" title=\"title\">link</a></p>"
  message: should support titles w/ single quotes
- name: test_link_resource_case_25
  input: '[link](/url (title))'
  output: "<p><a href=\"/url\" title=\"title\">link</a></p>"
  message: should support titles w/ parens
- name: test_link_resource_case_26
  input: "[link](/url \"title \\\"&quot;\")"
  output: "<p><a href=\"/url\" title=\"title &quot;&quot;\">link</a></p>"
  message: should support character references and escapes in titles
- name: test_link_resource_case_27
  input: "[link](/url \"title\")"
  output: "<p><a href=\"/url%C2%A0%22title%22\">link</a></p>"
  message: should not support unicode whitespace between destination and title
- name: test_link_resource_case_28
  input: "[link](/url \"title \"and\" title\")"
  output: <p>[link](/url &quot;title &quot;and&quot; title&quot;)</p>
  message: should not support nested balanced quotes in title
- name: test_link_resource_case_29
  input: "[link](/url 'title \"and\" title')"
  output: "<p><a href=\"/url\" title=\"title &quot;and&quot; title\">link</a></p>"
  message: should support the other quotes in titles
- name: test_link_resource_case_30
  input: |-
    [link](   /uri
      "title"  )
  output: "<p><a href=\"/uri\" title=\"title\">link</a></p>"
  message: should support whitespace around destination and title (1)
- name: test_link_resource_case_31
  input: "[link](\t\n/uri \"title\")"
  output: "<p><a href=\"/uri\" title=\"title\">link</a></p>"
  message: should support whitespace around destination and title (2)
- name: test_link_resource_case_32
  input: "[link](/uri  \"title\"\t\n)"
  output: "<p><a href=\"/uri\" title=\"title\">link</a></p>"
  message: should support whitespace around destination and title (3)
- name: test_link_resource_case_33
  input: '[link] (/uri)'
  output: <p>[link] (/uri)</p>
  message: should not support whitespace between label and resource
- name: test_link_resource_case_34
  input: '[link [foo [bar]]](/uri)'
  output: "<p><a href=\"/uri\">link [foo [bar]]</a></p>"
  message: should support balanced brackets
- name: test_link_resource_case_35
  input: '[link] bar](/uri)'
  output: <p>[link] bar](/uri)</p>
  message: should not support unbalanced brackets (1)
- name: test_link_resource_case_36
  input: '[link [bar](/uri)'
  output: "<p>[link <a href=\"/uri\">bar</a></p>"
  message: should not support unbalanced brackets (2)
- name: test_link_resource_case_37
  input: "[link \\[bar](/uri)"
  output: "<p><a href=\"/uri\">link [bar</a></p>"
  message: should support characer escapes
- name: test_link_resource_case_38
  input: '[link *foo **bar** `#`*](/uri)'
  output: "<p><a href=\"/uri\">link <em>foo <strong>bar</strong> <code>#</code></em></a></p>"
  message: should support content
- name: test_link_resource_case_39
  input: '[![moon](moon.jpg)](/uri)'
  output: "<p><a href=\"/uri\"><img src=\"moon.jpg\" alt=\"moon\" /></a></p>"
  message: should support an image as content
- name: test_link_resource_case_40
  input: '[foo [bar](/uri)](/uri)'
  output: "<p>[foo <a href=\"/uri\">bar</a>](/uri)</p>"
  message: should not support links in links (1)
- name: test_link_resource_case_41
  input: '[foo *[bar [baz](/uri)](/uri)*](/uri)'
  output: "<p>[foo <em>[bar <a href=\"/uri\">baz</a>](/uri)</em>](/uri)</p>"
  message: should not support links in links (2)
- name: test_link_resource_case_42
  input: '![[[foo](uri1)](uri2)](uri3)'
  output: "<p><img src=\"uri3\" alt=\"[foo](uri2)\" /></p>"
  message: should not support links in links (3)
- name: test_link_resource_case_43
  input: '*[foo*](/uri)'
  output: "<p>*<a href=\"/uri\">foo*</a></p>"
  message: should prefer links over emphasis (1)
- name: test_link_resource_case_44
  input: '[foo *bar](baz*)'
  output: "<p><a href=\"baz*\">foo *bar</a></p>"
  message: should prefer links over emphasis (2)
- name: test_link_resource_case_46
  input: '[foo`](/uri)`'
  output: <p>[foo<code>](/uri)</code></p>
  message: should prefer code over links
- name: test_link_resource_case_47
  input: '[foo<http://example.com/?search=](uri)>'
  output: "<p>[foo<a href=\"http://example.com/?search=%5D(uri)\">http://example.com/?search=](uri)</a></p>"
  message: should prefer autolinks over links
- name: test_link_resource_case_48
  input: '[foo<http://example.com/?search=](uri)>'
  output: "<p>[foo<a href=\"http://example.com/?search=%5D(uri)\">http://example.com/?search=](uri)</a></p>"
  message: should prefer autolinks over links
- name: test_link_resource_case_49
  input: '[]()'
  output: "<p><a href=\"\"></a></p>"
  message: should support an empty link
  comment: Extra
- name: test_link_resource_case_50
  input: "[](<> \"\")"
  output: "<p><a href=\"\"></a></p>"
  message: should ignore an empty title
  comment: 'See: <https://github.com/commonmark/commonmark.js/issues/192>'
- name: test_link_resource_case_52
  input: '[](<'
  output: <p>[](&lt;</p>
  message: should not support an unclosed enclosed destination
- name: test_link_resource_case_53
  input: '[]('
  output: <p>[](</p>
  message: should not support an unclosed destination
- name: test_link_resource_case_54
  input: "[](\\<)"
  output: "<p><a href=\"%3C\"></a></p>"
  message: should support unenclosed link destination starting w/ escapes
- name: test_link_resource_case_55
  input: "[](<\\<>)"
  output: "<p><a href=\"%3C\"></a></p>"
  message: should support enclosed link destination starting w/ escapes
- name: test_link_resource_case_56
  input: "[](\\"
  output: "<p>[](\\</p>"
  message: should not support unenclosed link destination starting w/ an incorrect escape
- name: test_link_resource_case_57
  input: "[](<\\"
  output: "<p>[](&lt;\\</p>"
  message: should not support enclosed link destination starting w/ an incorrect escape
- name: test_link_resource_case_58
  input: "[](a \""
  output: <p>[](a &quot;</p>
  message: should not support an eof in a link title (1)
- name: test_link_resource_case_59
  input: '[](a '''
  output: <p>[](a '</p>
  message: should not support an eof in a link title (2)
- name: test_link_resource_case_60
  input: '[](a ('
  output: <p>[](a (</p>
  message: should not support an eof in a link title (3)
- name: test_link_resource_case_61
  input: "[](a \"\\"
  output: "<p>[](a &quot;\\</p>"
  message: should not support an eof in a link title escape (1)
- name: test_link_resource_case_62
  input: "[](a '\\"
  output: "<p>[](a '\\</p>"
  message: should not support an eof in a link title escape (2)
- name: test_link_resource_case_63
  input: "[](a (\\"
  output: "<p>[](a (\\</p>"
  message: should not support an eof in a link title escape (3)
- name: test_link_resource_case_64
  input: "[](a \"\\\"\")"
  output: "<p><a href=\"a\" title=\"&quot;\"></a></p>"
  message: should support a character escape to start a link title (1)
- name: test_link_resource_case_65
  input: "[](a '\\'')"
  output: "<p><a href=\"a\" title=\"'\"></a></p>"
  message: should support a character escape to start a link title (2)
- name: test_link_resource_case_66
  input: "[](a (\\)))"
  output: "<p><a href=\"a\" title=\")\"></a></p>"
  message: should support a character escape to start a link title (3)
- name: test_link_resource_case_67
  input: "[&amp;&copy;&](example.com/&amp;&copy;& \"&amp;&copy;&\")"
  output: "<p><a href=\"example.com/&amp;%C2%A9&amp;\" title=\"&amp;©&amp;\">&amp;©&amp;</a></p>"
  message: should support character references in links
- name: test_link_resource_case_68
  input: '[a](1())'
  output: "<p><a href=\"1()\">a</a></p>"
  message: should support 1 set of parens
- name: test_link_resource_case_69
  input: '[a](1(2()))'
  output: "<p><a href=\"1(2())\">a</a></p>"
  message: should support 2 sets of parens
- name: test_link_resource_case_70
  input: "[a](1(2(3(4(5(6(7(8(9(10(11(12(13(14(15(16(17(18(19(20(21(22(23(24(25(26(27(28(29(30(31(32()))))))))))))))))))))))))))))))))"
  output: "<p><a href=\"1(2(3(4(5(6(7(8(9(10(11(12(13(14(15(16(17(18(19(20(21(22(23(24(25(26(27(28(29(30(31(32())))))))))))))))))))))))))))))))\"\
    >a</a></p>"
  message: should support 32 sets of parens
- name: test_link_resource_case_71
  input: "[a](1(2(3(4(5(6(7(8(9(10(11(12(13(14(15(16(17(18(19(20(21(22(23(24(25(26(27(28(29(30(31(32(33())))))))))))))))))))))))))))))))))"
  output: "<p>[a](1(2(3(4(5(6(7(8(9(10(11(12(13(14(15(16(17(18(19(20(21(22(23(24(25(26(27(28(29(30(31(32(33())))))))))))))))))))))))))))))))))</p>"
  message: should not support 33 or more sets of parens
- name: test_link_resource_case_72
  input: |-
    [a](b "
     c")
  output: |-
    <p><a href="b" title="
    c">a</a></p>
  message: should support an eol at the start of a title
- name: test_link_resource_case_73
  input: "[a](b( \"c\")"
  output: <p>[a](b( &quot;c&quot;)</p>
  message: should not support whitespace when unbalanced in a raw destination
- name: test_link_resource_case_74
  input: "[a](\0)"
  output: "<p><a href=\"%EF%BF%BD\">a</a></p>"
  message: should support a single NUL character as a link resource
to_html_with_options:
- name: test_link_resource_case_8
  input: |-
    [link](<foo
    bar>)
  output: |-
    <p>[link](<foo
    bar>)</p>
  message: should not support links w/ line endings in enclosed destination
  options: danger
- name: test_link_resource_case_11
  input: |-
    [a](<b)c
    [a](<b)c>
    [a](<b>c)
  output: |-
    <p>[a](&lt;b)c
    [a](&lt;b)c&gt;
    [a](<b>c)</p>
  message: should not support links w/ unmatched enclosed destinations
  options: danger
- name: test_link_resource_case_16
  input: "[link](foo\\)\\:)"
  output: "<p><a href=\"foo):\">link</a></p>"
  message: should support links w/ escapes in destinations
  options: danger
- name: test_link_resource_case_45
  input: "[foo <bar attr=\"](baz)\">"
  output: "<p>[foo <bar attr=\"](baz)\"></p>"
  message: should prefer HTML over links
  options: danger
- name: test_link_resource_case_51
  input: "[a](<b>\"c\")"
  output: <p>[a](<b>&quot;c&quot;)</p>
  message: should require whitespace between enclosed destination and title
  options: danger
to_mdast:
- name: test_link_resource_case_75
  input: a [alpha]() b [bravo](charlie 'delta') c.
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
      children = ?'vec!'([
        markdown_mdast_node:paragraph(#markdown_mdast_paragraph{
          children = ?'vec!'([
            markdown_mdast_node:text(#markdown_mdast_text{
              value = <<"a ">>,
              position = {some, markdown_unist_position:new(1, 1, 0, 1, 3, 2)}
            }),
            markdown_mdast_node:link(#markdown_mdast_link{
              url = <<"">>,
              title = none,
              children = ?'vec!'([
                markdown_mdast_node:text(#markdown_mdast_text{
                  value = <<"alpha">>,
                  position = {some, markdown_unist_position:new(1, 4, 3, 1, 9, 8)}
                })
              ]),
              position = {some, markdown_unist_position:new(1, 3, 2, 1, 12, 11)}
            }),
            markdown_mdast_node:text(#markdown_mdast_text{
              value = <<" b ">>,
              position = {some, markdown_unist_position:new(1, 12, 11, 1, 15, 14)}
            }),
            markdown_mdast_node:link(#markdown_mdast_link{
              url = <<"charlie">>,
              title = {some, <<"delta">>},
              children = ?'vec!'([
                markdown_mdast_node:text(#markdown_mdast_text{
                  value = <<"bravo">>,
                  position = {some, markdown_unist_position:new(1, 16, 15, 1, 21, 20)}
                })
              ]),
              position = {some, markdown_unist_position:new(1, 15, 14, 1, 39, 38)}
            }),
            markdown_mdast_node:text(#markdown_mdast_text{
              value = <<" c.">>,
              position = {some, markdown_unist_position:new(1, 39, 38, 1, 42, 41)}
            })
          ]),
          position = {some, markdown_unist_position:new(1, 1, 0, 1, 42, 41)}
        })
      ]),
      position = {some, markdown_unist_position:new(1, 1, 0, 1, 42, 41)}
    })
  message: "should support link (resource) as `Link`s in mdast"
  parse_options: ParseOptions::default()
- name: test_link_resource_case_76
  input: '[![name](image)](url)'
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
      children = ?'vec!'([
        markdown_mdast_node:paragraph(#markdown_mdast_paragraph{
          children = ?'vec!'([
            markdown_mdast_node:link(#markdown_mdast_link{
              children = ?'vec!'([
                markdown_mdast_node:image(#markdown_mdast_image{
                  alt = <<"name">>,
                  url = <<"image">>,
                  title = none,
                  position = {some, markdown_unist_position:new(1, 2, 1, 1, 16, 15)}
                })
              ]),
              url = <<"url">>,
              title = none,
              position = {some, markdown_unist_position:new(1, 1, 0, 1, 22, 21)}
            })
          ]),
          position = {some, markdown_unist_position:new(1, 1, 0, 1, 22, 21)}
        })
      ]),
      position = {some, markdown_unist_position:new(1, 1, 0, 1, 22, 21)}
    })
  message: "should support nested links in mdast"
  parse_options: ParseOptions::default()
