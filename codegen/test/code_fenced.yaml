# yaml-language-server: $schema=./schema.json

###-----------------------------------------------------------------------------
### %CopyrightBegin%
###
### SPDX-License-Identifier: Apache-2.0
###
### Copyright (c) Meta Platforms, Inc. and affiliates.
### Copyright (c) WhatsApp LLC
###
### Licensed under the Apache License, Version 2.0 (the "License");
### you may not use this file except in compliance with the License.
### You may obtain a copy of the License at
###
###     http://www.apache.org/licenses/LICENSE-2.0
###
### Unless required by applicable law or agreed to in writing, software
### distributed under the License is distributed on an "AS IS" BASIS,
### WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
### See the License for the specific language governing permissions and
### limitations under the License.
###
### %CopyrightEnd%
###-----------------------------------------------------------------------------

---
suite:
  name: code_fenced
  created: 2025-10-27
  modified: 2025-10-27
to_html:
- name: test_code_fenced_case_1
  input: |-
    ```
    <
     >
    ```
  output: |-
    <pre><code>&lt;
     &gt;
    </code></pre>
  message: should support fenced code w/ grave accents
- name: test_code_fenced_case_2
  input: |-
    ~~~
    <
     >
    ~~~
  output: |-
    <pre><code>&lt;
     &gt;
    </code></pre>
  message: should support fenced code w/ tildes
- name: test_code_fenced_case_3
  input: |-
    ``
    foo
    ``
  output: <p><code>foo</code></p>
  message: should not support fenced code w/ less than three markers
- name: test_code_fenced_case_4
  input: |-
    ```
    aaa
    ~~~
    ```
  output: |-
    <pre><code>aaa
    ~~~
    </code></pre>
  message: should not support a tilde closing sequence for a grave accent opening sequence
- name: test_code_fenced_case_5
  input: |-
    ~~~
    aaa
    ```
    ~~~
  output: |-
    <pre><code>aaa
    ```
    </code></pre>
  message: should not support a grave accent closing sequence for a tilde opening sequence
- name: test_code_fenced_case_6
  input: |-
    ````
    aaa
    ```
    ``````
  output: |-
    <pre><code>aaa
    ```
    </code></pre>
  message: should support a closing sequence longer, but not shorter than, the opening
- name: test_code_fenced_case_7
  input: |-
    ~~~~
    aaa
    ~~~
    ~~~~
  output: |-
    <pre><code>aaa
    ~~~
    </code></pre>
  message: should support a closing sequence equal to, but not shorter than, the opening
- name: test_code_fenced_case_8
  input: '```'
  output: |
    <pre><code></code></pre>
  message: should support an eof right after an opening sequence
- name: test_code_fenced_case_9
  input: |
    `````

    ```
    aaa
  output: |
    <pre><code>
    ```
    aaa
    </code></pre>
  message: should support an eof somewhere in content
- name: test_code_fenced_case_10
  input: |-
    > ```
    > aaa

    bbb
  output: |-
    <blockquote>
    <pre><code>aaa
    </code></pre>
    </blockquote>
    <p>bbb</p>
  message: should support no closing sequence in a block quote
- name: test_code_fenced_case_11
  input: "```\n\n  \n```"
  output: "<pre><code>\n  \n</code></pre>"
  message: should support blank lines in fenced code
- name: test_code_fenced_case_12
  input: |-
    ```
    ```
  output: <pre><code></code></pre>
  message: should support empty fenced code
- name: test_code_fenced_case_13
  input: |2-
     ```
     aaa
    aaa
    ```
  output: |-
    <pre><code>aaa
    aaa
    </code></pre>
  message: "should remove up to one space from the content if the opening sequence is indented w/ 1 space"
- name: test_code_fenced_case_14
  input: |2-
      ```
    aaa
      aaa
    aaa
      ```
  output: |-
    <pre><code>aaa
    aaa
    aaa
    </code></pre>
  message: "should remove up to two space from the content if the opening sequence is indented w/ 2 spaces"
- name: test_code_fenced_case_15
  input: |2-
       ```
       aaa
        aaa
      aaa
       ```
  output: |-
    <pre><code>aaa
     aaa
    aaa
    </code></pre>
  message: "should remove up to three space from the content if the opening sequence is indented w/ 3 spaces"
- name: test_code_fenced_case_16
  input: |2-
        ```
        aaa
        ```
  output: |-
    <pre><code>```
    aaa
    ```
    </code></pre>
  message: should not support indenteding the opening sequence w/ 4 spaces
- name: test_code_fenced_case_17
  input: |-
    ```
    aaa
      ```
  output: |-
    <pre><code>aaa
    </code></pre>
  message: should support an indented closing sequence
- name: test_code_fenced_case_18
  input: |2-
       ```
    aaa
      ```
  output: |-
    <pre><code>aaa
    </code></pre>
  message: should support a differently indented closing sequence than the opening sequence
- name: test_code_fenced_case_19
  input: |
    ```
    aaa
        ```
  output: |
    <pre><code>aaa
        ```
    </code></pre>
  message: should not support an indented closing sequence w/ 4 spaces
- name: test_code_fenced_case_20
  input: |-
    ``` ```
    aaa
  output: |-
    <p><code> </code>
    aaa</p>
  message: should not support grave accents in the opening fence after the opening sequence
- name: test_code_fenced_case_21
  input: |
    ~~~~~~
    aaa
    ~~~ ~~
  output: |
    <pre><code>aaa
    ~~~ ~~
    </code></pre>
  message: should not support spaces in the closing sequence
- name: test_code_fenced_case_22
  input: |-
    foo
    ```
    bar
    ```
    baz
  output: |-
    <p>foo</p>
    <pre><code>bar
    </code></pre>
    <p>baz</p>
  message: should support interrupting paragraphs
- name: test_code_fenced_case_23
  input: |-
    foo
    ---
    ~~~
    bar
    ~~~
    # baz
  output: |-
    <h2>foo</h2>
    <pre><code>bar
    </code></pre>
    <h1>baz</h1>
  message: should support interrupting other content
- name: test_code_fenced_case_24
  input: |-
    ```ruby
    def foo(x)
      return 3
    end
    ```
  output: |-
    <pre><code class="language-ruby">def foo(x)
      return 3
    end
    </code></pre>
  message: should support the info string as a `language-` class (1)
- name: test_code_fenced_case_25
  input: |-
    ````;
    ````
  output: "<pre><code class=\"language-;\"></code></pre>"
  message: should support the info string as a `language-` class (2)
- name: test_code_fenced_case_26
  input: |-
    ~~~~    ruby startline=3 $%@#$
    def foo(x)
      return 3
    end
    ~~~~~~~
  output: |-
    <pre><code class="language-ruby">def foo(x)
      return 3
    end
    </code></pre>
  message: should support the info string as a `language-` class, but not the meta string
- name: test_code_fenced_case_27
  input: |-
    ``` aa ```
    foo
  output: |-
    <p><code>aa</code>
    foo</p>
  message: should not support grave accents in the meta string
- name: test_code_fenced_case_28
  input: |-
    ~~~ aa ``` ~~~
    foo
    ~~~
  output: |-
    <pre><code class="language-aa">foo
    </code></pre>
  message: should support grave accents and tildes in the meta string of tilde fenced code
- name: test_code_fenced_case_29
  input: |-
    ```
    ``` aaa
    ```
  output: |-
    <pre><code>``` aaa
    </code></pre>
  message: should not support info string on closing sequences
- name: test_code_fenced_case_30
  input: '```  '
  output: |
    <pre><code></code></pre>
  message: should support an eof after whitespace, after the start fence sequence
  comment: 'Our own:'
- name: test_code_fenced_case_31
  input: |-
    ```  js
    alert(1)
    ```
  output: |-
    <pre><code class="language-js">alert(1)
    </code></pre>
  message: should support whitespace between the sequence and the info string
- name: test_code_fenced_case_32
  input: '```js'
  output: |
    <pre><code class="language-js"></code></pre>
  message: should support an eof after the info string
- name: test_code_fenced_case_33
  input: "```  js \nalert(1)\n```"
  output: |-
    <pre><code class="language-js">alert(1)
    </code></pre>
  message: should support whitespace after the info string
- name: test_code_fenced_case_34
  input: "```\n  "
  output: "<pre><code>  \n</code></pre>\n"
  message: should support an eof after whitespace in content
- name: test_code_fenced_case_35
  input: "  ```\n "
  output: |
    <pre><code></code></pre>
  message: should support an eof in the prefix, in content
- name: test_code_fenced_case_36
  input: "```j\\+s&copy;"
  output: |
    <pre><code class="language-j+s©"></code></pre>
  message: should support character escapes and character references in info strings
- name: test_code_fenced_case_37
  input: "```a\\&b\0c"
  output: |
    <pre><code class="language-a&amp;b�c"></code></pre>
  message: should encode dangerous characters in languages
- name: test_code_fenced_case_38
  input: |2-
       ```
    aaa
        ```
  output: |
    <pre><code>aaa
     ```
    </code></pre>
  message: "should not support a closing sequence w/ too much indent, regardless of opening sequence (1)"
- name: test_code_fenced_case_39
  input: |-
    > ```
    >
    >
    >

    a
  output: |-
    <blockquote>
    <pre><code>


    </code></pre>
    </blockquote>
    <p>a</p>
  message: "should not support a closing sequence w/ too much indent, regardless of opening sequence (2)"
- name: test_code_fenced_case_40
  input: |-
    > ```a
    b
  output: |-
    <blockquote>
    <pre><code class="language-a"></code></pre>
    </blockquote>
    <p>b</p>
  message: should not support lazyness (1)
- name: test_code_fenced_case_41
  input: |-
    > a
    ```b
  output: |
    <blockquote>
    <p>a</p>
    </blockquote>
    <pre><code class="language-b"></code></pre>
  message: should not support lazyness (2)
- name: test_code_fenced_case_42
  input: |-
    > ```a
    ```
  output: |
    <blockquote>
    <pre><code class="language-a"></code></pre>
    </blockquote>
    <pre><code></code></pre>
  message: should not support lazyness (3)
to_html_with_options:
- name: test_code_fenced_case_43
  input: '```'
  output: <p>```</p>
  message: should support turning off code (fenced)
  options:
    parse:
      constructs:
        code_fenced: false
to_mdast:
- name: test_code_fenced_case_44
  input: |-
    ```js extra
    console.log(1)
    console.log(2)
    ```
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
        children = ?'vec!'([
            markdown_mdast_node:code(#markdown_mdast_code{
                lang = {some, <<"js">>},
                meta = {some, <<"extra">>},
                value = <<"console.log(1)\nconsole.log(2)">>,
                position = {some, markdown_unist_position:new(1, 1, 0, 4, 4, 45)}
            })
        ]),
        position = {some, markdown_unist_position:new(1, 1, 0, 4, 4, 45)}
    })
  message: "should support code (fenced) as `Code`s in mdast"
  parse_options: {}
- name: test_code_fenced_case_45
  input: |-
    ```
    asd
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
        children = ?'vec!'([
            markdown_mdast_node:code(#markdown_mdast_code{
                lang = none,
                meta = none,
                value = <<"asd">>,
                position = {some, markdown_unist_position:new(1, 1, 0, 2, 4, 7)}
            })
        ]),
        position = {some, markdown_unist_position:new(1, 1, 0, 2, 4, 7)}
    })
  message: "should support code (fenced) w/o closing fence in mdast"
  parse_options: {}
- name: test_code_fenced_case_46
  input: "```\rasd\r```"
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
        children = ?'vec!'([
            markdown_mdast_node:code(#markdown_mdast_code{
                lang = none,
                meta = none,
                value = <<"asd">>,
                position = {some, markdown_unist_position:new(1, 1, 0, 3, 4, 11)}
            })
        ]),
        position = {some, markdown_unist_position:new(1, 1, 0, 3, 4, 11)}
    })
  message: "should support code (fenced) w/o CR line endings"
  parse_options: {}
- name: test_code_fenced_case_47
  input: "```\r\nasd\r\n```"
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
        children = ?'vec!'([
            markdown_mdast_node:code(#markdown_mdast_code{
                lang = none,
                meta = none,
                value = <<"asd">>,
                position = {some, markdown_unist_position:new(1, 1, 0, 3, 4, 13)}
            })
        ]),
        position = {some, markdown_unist_position:new(1, 1, 0, 3, 4, 13)}
    })
  message: "should support code (fenced) w/o CR+LF line endings"
  parse_options: {}

