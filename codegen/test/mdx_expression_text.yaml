# yaml-language-server: $schema=./schema.json

###-----------------------------------------------------------------------------
### %CopyrightBegin%
###
### SPDX-License-Identifier: Apache-2.0
###
### Copyright (c) Meta Platforms, Inc. and affiliates.
### Copyright (c) WhatsApp LLC
###
### Licensed under the Apache License, Version 2.0 (the "License");
### you may not use this file except in compliance with the License.
### You may obtain a copy of the License at
###
###     http://www.apache.org/licenses/LICENSE-2.0
###
### Unless required by applicable law or agreed to in writing, software
### distributed under the License is distributed on an "AS IS" BASIS,
### WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
### See the License for the specific language governing permissions and
### limitations under the License.
###
### %CopyrightEnd%
###-----------------------------------------------------------------------------

---
suite:
  name: mdx_expression_text
  created: 2025-10-29
  modified: 2025-10-29
shared_options:
  - name: mdx
    options:
      extend: mdx
  - name: swc
    options:
      extend: mdx
      parse:
        mdx_esm_parse: fun markdown_test_utils_swc:parse_esm/1
        mdx_expression_parse: fun markdown_test_utils_swc:parse_expression/2
shared_parse_options:
  - name: mdx_parse
    parse_options:
      extend: mdx
  - name: swc_parse
    parse_options:
      extend: mdx
      mdx_esm_parse: fun markdown_test_utils_swc:parse_esm/1
      mdx_expression_parse: fun markdown_test_utils_swc:parse_expression/2
to_html: []
to_html_with_options:
- name: test_mdx_expression_text_case_1
  input: a {} b
  output: <p>a  b</p>
  message: should support an empty expression (1)
  options: swc
- name: test_mdx_expression_text_case_2
  input: "a { \t\r\n} b"
  output: <p>a  b</p>
  message: should support an empty expression (2)
  options: swc
- name: test_mdx_expression_text_case_3
  input: a {/**/} b
  output: <p>a  b</p>
  message: should support a multiline comment (1)
  options: swc
- name: test_mdx_expression_text_case_4
  input: "a {  /*\n*/\t} b"
  output: <p>a  b</p>
  message: should support a multiline comment (2)
  options: swc
- name: test_mdx_expression_text_case_5
  input: a {/*b*//*c*/} d
  output: <p>a  d</p>
  message: should support a multiline comment (3)
  options: swc
- name: test_mdx_expression_text_case_6
  input: a {b/*c*/} d
  output: <p>a  d</p>
  message: should support a multiline comment (4)
  options: swc
- name: test_mdx_expression_text_case_7
  input: a {/*b*/c} d
  output: <p>a  d</p>
  message: should support a multiline comment (5)
  options: swc
- name: test_mdx_expression_text_case_8
  input: a {//} b
  output: '1:9: Could not parse expression with swc: Unexpected eof (mdx:swc)'
  message: should crash on an incorrect line comment (1)
  options: swc
- name: test_mdx_expression_text_case_9
  input: a { // b } c
  output: '1:13: Could not parse expression with swc: Unexpected eof (mdx:swc)'
  message: should crash on an incorrect line comment (2)
  options: swc
- name: test_mdx_expression_text_case_10
  input: |-
    a {//
    } b
  output: <p>a  b</p>
  message: should support a line comment followed by a line ending
  options: swc
- name: test_mdx_expression_text_case_11
  input: |-
    a {// b
    c} d
  output: <p>a  d</p>
  message: should support a line comment followed by a line ending and an expression
  options: swc
- name: test_mdx_expression_text_case_12
  input: |-
    a {b// c
    } d
  output: <p>a  d</p>
  message: should support an expression followed by a line comment and a line ending
  options: swc
- name: test_mdx_expression_text_case_13
  input: |-
    a {/*b*/ // c
    } d
  output: <p>a  d</p>
  message: should support comments
  options: swc
- name: test_mdx_expression_text_case_14
  input: a {b.c} d
  output: <p>a  d</p>
  message: should support expression statements (1)
  options: swc
- name: test_mdx_expression_text_case_15
  input: a {1 + 1} b
  output: <p>a  b</p>
  message: should support expression statements (2)
  options: swc
- name: test_mdx_expression_text_case_16
  input: a {function () {}} b
  output: <p>a  b</p>
  message: should support expression statements (3)
  options: swc
- name: test_mdx_expression_text_case_17
  input: "a {var b = \"c\"} d"
  output: '1:4: Could not parse expression with swc: Expression expected (mdx:swc)'
  message: should crash on non-expressions
  options: swc
- name: test_mdx_expression_text_case_18
  input: |-
    > a {
    > b} c
  output: |-
    <blockquote>
    <p>a  c</p>
    </blockquote>
  message: should support expressions in containers
  options: swc
- name: test_mdx_expression_text_case_19
  input: |-
    > a {
    > b<} c
  output: '2:8: Could not parse expression with swc: Unexpected eof (mdx:swc)'
  message: should crash on incorrect expressions in containers (1)
  options: swc
- name: test_mdx_expression_text_case_20
  input: |-
    > a {
    > b
    > c} d
  output: "3:7: Could not parse expression with swc: Unexpected content after expression (mdx:swc)"
  message: should crash on incorrect expressions in containers (2)
  options: swc
- name: test_mdx_expression_text_case_21
  input: a {b} c
  output: <p>a  c</p>
  message: should support an expression
  options: mdx
- name: test_mdx_expression_text_case_22
  input: a {} b
  output: <p>a  b</p>
  message: should support an empty expression
  options: mdx
- name: test_mdx_expression_text_case_23
  input: a {b c
  output: "1:7: Unexpected end of file in expression, expected a corresponding closing brace for `{` (markdown-rs:unexpected-eof)"
  message: should crash if no closing brace is found (1)
  options: mdx
- name: test_mdx_expression_text_case_24
  input: a {b { c } d
  output: "1:13: Unexpected end of file in expression, expected a corresponding closing brace for `{` (markdown-rs:unexpected-eof)"
  message: should crash if no closing brace is found (2)
  options: mdx
- name: test_mdx_expression_text_case_25
  input: |-
    a {
    } b
  output: <p>a  b</p>
  message: should support a line ending in an expression
  options: mdx
- name: test_mdx_expression_text_case_26
  input: a } b
  output: <p>a } b</p>
  message: should support just a closing brace
  options: mdx
- name: test_mdx_expression_text_case_27
  input: '{ a } b'
  output: <p> b</p>
  message: should support expressions as the first thing when following by other things
  options: mdx
- name: test_mdx_expression_text_case_29
  input: a {b} c
  output: <p>a  c</p>
  message: should support an expression
  options: swc
- name: test_mdx_expression_text_case_30
  input: a {??} b
  output: '1:9: Could not parse expression with swc: Unexpected eof (mdx:swc)'
  message: should crash on an incorrect expression
  options: swc
- name: test_mdx_expression_text_case_31
  input: a {} b
  output: <p>a  b</p>
  message: should support an empty expression
  options: swc
- name: test_mdx_expression_text_case_32
  input: a {b c
  output: "1:7: Unexpected end of file in expression, expected a corresponding closing brace for `{` (markdown-rs:unexpected-eof)"
  message: should crash if no closing brace is found (1)
  options: swc
- name: test_mdx_expression_text_case_33
  input: a {b { c } d
  output: "1:13: Could not parse expression with swc: Unexpected content after expression (mdx:swc)"
  message: should crash if no closing brace is found (2)
  options: swc
- name: test_mdx_expression_text_case_34
  input: |-
    a {
    } b
  output: <p>a  b</p>
  message: should support a line ending in an expression
  options: swc
- name: test_mdx_expression_text_case_35
  input: a } b
  output: <p>a } b</p>
  message: should support just a closing brace
  options: swc
- name: test_mdx_expression_text_case_36
  input: '{ a } b'
  output: <p> b</p>
  message: should support expressions as the first thing when following by other things
  options: swc
- name: test_mdx_expression_text_case_37
  input: a { /* { */ } b
  output: <p>a  b</p>
  message: should support an unbalanced opening brace (if JS permits)
  options: swc
- name: test_mdx_expression_text_case_38
  input: a { /* } */ } b
  output: <p>a  b</p>
  message: should support an unbalanced closing brace (if JS permits)
  options: swc
to_mdast:
- name: test_mdx_expression_text_case_28
  input: a {alpha} b.
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
        children = ?'vec!'([
            markdown_mdast_node:paragraph(#markdown_mdast_paragraph{
                children = ?'vec!'([
                    markdown_mdast_node:text(#markdown_mdast_text{
                        value = <<"a ">>,
                        position = {some, markdown_unist_position:new(1, 1, 0, 1, 3, 2)}
                    }),
                    markdown_mdast_node:mdx_text_expression(#markdown_mdast_mdx_text_expression{
                        value = <<"alpha">>,
                        position = {some, markdown_unist_position:new(1, 3, 2, 1, 10, 9)},
                        stops = ?'vec!'([markdown_mdast_stop:new(0, 3)])
                    }),
                    markdown_mdast_node:text(#markdown_mdast_text{
                        value = <<" b.">>,
                        position = {some, markdown_unist_position:new(1, 10, 9, 1, 13, 12)}
                    })
                ]),
                position = {some, markdown_unist_position:new(1, 1, 0, 1, 13, 12)}
            })
        ]),
        position = {some, markdown_unist_position:new(1, 1, 0, 1, 13, 12)}
    })
  message: "should support mdx expressions (text) as `MdxTextExpression`s in mdast"
  parse_options: mdx_parse
- name: test_mdx_expression_text_case_39
  input: |-
    > alpha {`
    > bravo
    >  charlie
    >   delta
    >    echo
    > `} foxtrot.
  output: |-
    markdown_mdast_node:root(#markdown_mdast_root{
        children = ?'vec!'([
            markdown_mdast_node:blockquote(#markdown_mdast_blockquote{
                children = ?'vec!'([
                    markdown_mdast_node:paragraph(#markdown_mdast_paragraph{
                        children = ?'vec!'([
                            markdown_mdast_node:text(#markdown_mdast_text{
                                value = <<"alpha ">>,
                                position = {some, markdown_unist_position:new(1, 3, 2, 1, 9, 8)}
                            }),
                            markdown_mdast_node:mdx_text_expression(#markdown_mdast_mdx_text_expression{
                                value = <<"`\nbravo\ncharlie\ndelta\n echo\n`">>,
                                position = {some, markdown_unist_position:new(1, 9, 8, 6, 5, 54)},
                                stops = ?'vec!'([
                                    markdown_mdast_stop:new(0, 9),
                                    markdown_mdast_stop:new(1, 10),
                                    markdown_mdast_stop:new(2, 13),
                                    markdown_mdast_stop:new(7, 18),
                                    markdown_mdast_stop:new(8, 22),
                                    markdown_mdast_stop:new(15, 29),
                                    markdown_mdast_stop:new(16, 34),
                                    markdown_mdast_stop:new(21, 39),
                                    markdown_mdast_stop:new(22, 44),
                                    markdown_mdast_stop:new(27, 49),
                                    markdown_mdast_stop:new(28, 52)
                                ])
                            }),
                            markdown_mdast_node:text(#markdown_mdast_text{
                                value = <<" foxtrot.">>,
                                position = {some, markdown_unist_position:new(6, 5, 54, 6, 14, 63)}
                            })
                        ]),
                        position = {some, markdown_unist_position:new(1, 3, 2, 6, 14, 63)}
                    })
                ]),
                position = {some, markdown_unist_position:new(1, 1, 0, 6, 14, 63)}
            })
        ]),
        position = {some, markdown_unist_position:new(1, 1, 0, 6, 14, 63)}
    })
  message: "should keep the correct number of spaces in a blockquote (text)"
  parse_options: swc_parse
