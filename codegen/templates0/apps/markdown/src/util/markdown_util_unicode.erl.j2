%%%-----------------------------------------------------------------------------
%%% Copyright (c) Meta Platforms, Inc. and affiliates.
%%% Copyright (c) WhatsApp LLC
%%%
%%% This source code is licensed under the MIT license found in the
%%% LICENSE.md file in the root directory of this source tree.
%%%-----------------------------------------------------------------------------
%%% % @format
-module(markdown_util_unicode).
-moduledoc """
Info on Unicode.

List of characters that are considered punctuation.

> ðŸ‘‰ **Important**: this module is generated by `just generate`.
> It is generate from the latest Unicode data.

Rust does not contain an `is_punctuation` method on `char`, while it does
support [`is_ascii_alphanumeric`](char::is_ascii_alphanumeric).

`CommonMark` handles attention (emphasis, strong) markers based on what
comes before or after them.
One such difference is if those characters are Unicode punctuation.

## References

*   [*Â§ 2.1 Characters and lines* in `CommonMark`](https://spec.commonmark.org/0.31.2/#unicode-punctuation-character)
""".
-moduledoc #{author => ["Andrew Bennett <potatosaladx@meta.com>"]}.
-moduledoc #{created => "2025-03-04", modified => "2025-09-27"}.
-moduledoc #{copyright => "Meta Platforms, Inc. and affiliates."}.
-compile(warn_missing_spec_all).
-oncall("whatsapp_clr").

%% API
-export([
    is_punctuation/1,
    is_whitespace/1
]).

%% Macros
%% erlfmt-ignore
-define(WHITESPACE_LUT(), {
    2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0
}).

%%%=============================================================================
%%% API functions
%%%=============================================================================

-spec is_punctuation(char()) -> boolean().
~J{ for punctuation in ctx.commonmark.punctuation_list }.
is_punctuation(16#~J< punctuation.char_code >.) -> true;
~J{ endfor }.
is_punctuation(_) -> false.

%% erlfmt-ignore
-spec is_whitespace(char()) -> boolean().
is_whitespace($\s) ->
    true;
is_whitespace(C) when C >= 16#09 andalso C =< 16#0D -> true;
is_whitespace(C) when C > 16#7F ->
    case C bsr 8 of
        0 -> (element((C band 16#FF) + 1, ?WHITESPACE_LUT()) band 1) =/= 0;
        22 -> C =:= 16#1680;
        32 -> (element((C band 16#FF) + 1, ?WHITESPACE_LUT()) band 2) =/= 0;
        48 -> C =:= 16#3000;
        _ -> false
    end;
is_whitespace(_) ->
    false.
